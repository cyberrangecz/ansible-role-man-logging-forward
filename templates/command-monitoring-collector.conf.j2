#  /etc/rsyslog.conf	Configuration file for rsyslog.
#
#			For more information see
#			/usr/share/doc/rsyslog-doc/html/rsyslog_conf.html


#################
#### MODULES ####
#################

# provides TCP syslog reception
#
##TEMPLATE

template(name="KYPOTraining" type="string" string="KYPO_BASH_ACTION_AUDIT --- %rawmsg%")

module(load="imrelp")
module(load="omrelp")
$ModLoad imuxsock
$ModLoad imklog
input(type="imrelp" port="514" Ruleset="remote")
$template RemoteHost,"/var/log/KYPO/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/kypolog.log"
$RuleSet remote
*.* ?RemoteHost
# Send messages we receive to Gremlin
action(type="omrelp" 
target="{{central_server_address}}" 
port="514" template="KYPOTraining" 
tls="on"
tls.permittedPeer=["SHA1:{{central_server_certificate_sha}}"]
tls.myCert="/etc/rsyslog.d/client-cert.pem"
tls.myPrivKey="/etc/rsyslog.d/client-key.pem"
tls.authMode="fingerprint"
queue.type="LinkedList" 
queue.size="200" #does not support small numbers, more info in documentation
queue.filename="useraction_queue" 
queue.maxdiskspace="10m"
queue.saveonshutdown="on"
action.resumeInterval="10"
action.resumeRetryCount="-1")

stop